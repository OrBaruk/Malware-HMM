from ast import literal_eval
import sys
import numpy as np
from sklearn.cluster import MeanShift, estimate_bandwidth

def main():
	if len(sys.argv) != 2:
		print("Usage: python3 parsejson.py [file.hist]")
		return

	try:
		f = open(sys.argv[1])
	except FileNotFound:
		print('Error: File not found.')
		return

	s = f.read()
	if s:
		val = literal_eval(s)
	else:
		return
	
	raw = []
	for v in val:
		for x in range(0,v[1]):
			raw.append(v[0])

	cs = get_clusters(raw)

	out = []
	for c in cs:
		out.append(int(c[0]))

	print(out)
	return

def get_clusters(val):

	x = []

	for v in val:
		x.append([v,0])

	X = np.array(x, dtype=np.int)
	try:
		bandwidth = estimate_bandwidth(X, quantile=0.3)
		ms = MeanShift(bandwidth=bandwidth, bin_seeding=True)
		ms.fit(X)
		labels = ms.labels_
		cluster_centers = ms.cluster_centers_

		labels_unique = np.unique(labels)
		n_clusters_ = len(labels_unique)

		return cluster_centers
	except ValueError:
		print("Small sample size", file=sys.stderr)
		return [(0,0)]

if __name__ == '__main__':
	main()
