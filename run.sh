#!/bin/bash

files=("Trojan.Agent" "Trojan.Pincav" "UNKNOWN"  "Worm.Allaple" "Worm.Palevo"
"dedler" "heolag" "tibbs")

# Small sample size // Ignored
#"Trojan.Bifrose" "Trojan.Buzus" "Trojan.Downloader" "Trojan.Dropper"
#"Trojan.FakeSSH" "Trojan.IRCBot" "Trojan.Lolbot" "Trojan.Renos" "Trojan.Inject"
#"Trojan.SdBot" "Trojan.Small" "Trojan.Spy" "Trojan.TDSS" "Trojan.Zbot"
#"W32.Virut" "Worm.Agent" "Worm.Autorun" "Worm.Bybz" "Worm.Kolab" "Worm.Peda"
#"Trojan.Nepoe"

encoder=./bin/encoder
histogram=./bin/histogram
mfa2long=./bin/mfa2long
logs_train=./data/train/logs
logs_test=./data/test/logs
sequences_train=./data/train/sequences
sequences_test=./data/test/sequences
alignment_train=./data/train/alignment
alignment_test=./data/test/alignment
long_train=./data/train/alignment/long
long_test=./data/test/alignment/long
hmm=./hmm

# mkdirs

# clean
rm $mfa2long/*
rm $sequences_train/*
rm $sequences_test/*
rm $alignment_train/*
rm $alignment_test/*
rm $long_train/*
rm $long_test/*
rm $hmm/*

# buildproject

# encode files
for file in "${files[@]}"
do
  echo ">>$file"
  # Trainning Data
  $encoder $logs_train/$file* >  $sequences_train/$file.fa
  # Test Data
  # $encoder $logs_test/$file* > $sequences_test/$file.fa

  # run mafft
  # mafft --auto --text $sequences_train/$file.fa > $alignment_train/$file.mfa 2> /dev/null
  # mafft --auto --text $sequences_test/$file.fa > $alignment_test/$file.mfa

  # convert to long format
  $mfa2long $alignment_train/$file.mfa > $long_train/$file.long
  # $mfa2long $alignment_test/$file.mfa > $long_test/$file.long

  # generate histogram
  $histogram 

  # run hmmbuild
  # hmmbuild $hmm/$file.hmm $alignment_train/$file.mfa
done

$encoder $logs_train/*.beh > $sequences_train/All.fa
# $encoder $logs_test/*.beh > $sequences_test/All.fa


# run hmmsearch
